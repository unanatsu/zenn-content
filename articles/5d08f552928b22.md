---
title: "Raspberry Piã‚’æ´»ç”¨ï¼Sambaã§è‡ªå®…ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚‹æ‰‹é †"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["raspberrypi", "raspberrypi4", "samba"]
published: true
publishedl_at: 2025-02-13 00:00
---

# 1. ã¯ã˜ã‚ã«
## è¨˜äº‹ã®ç›®çš„
Raspberry Piã¨Sambaã‚’æ´»ç”¨ã—ã¦ã€è‡ªå®…ã«ç°¡å˜ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚Sambaã‚’ä½¿ã†ã“ã¨ã§ã€Windowsã‚„Macãªã©ã®ç•°ãªã‚‹ãƒ‡ãƒã‚¤ã‚¹é–“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã§ãã‚‹ç’°å¢ƒã‚’ä½œã‚Œã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€å¿…è¦ãªæ©Ÿå™¨ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æº–å‚™ã€Sambaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®šæ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚
# 2. ç’°å¢ƒ
## Raspberry Pi
### Raspberry Pi 4 Model Bï¼ˆ8GBï¼‰
https://www.amazon.co.jp/dp/B0891RC99L?ref_=ppx_hzsearch_conn_dt_b_fed_asin_title_1#customerReviews
- é«˜æ€§èƒ½ãª ARM Cortex-A72 ã‚’æ¡ç”¨ã—ã€PCã«è¿‘ã„æ€§èƒ½ã¸é€²åŒ–
- å‹•ä½œã‚¯ãƒ­ãƒƒã‚¯ãŒ 1.2GHz â†’ 1.5GHz ã«ãªã‚Šã€å‡¦ç†é€Ÿåº¦ãŒå‘ä¸Š
- 4K@60fps å¯¾å¿œã®GPUã‚’æ­è¼‰ã—ã€H.265ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚„OpenGL ES 3.0ã‚‚ã‚µãƒãƒ¼ãƒˆ
- micro HDMIãƒãƒ¼ãƒˆÃ—2 ã§ãƒ‡ãƒ¥ã‚¢ãƒ«ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤å‡ºåŠ›ãŒå¯èƒ½
- æ–°SoCã®æ¡ç”¨ã«ã‚ˆã‚Š USB 3.0 ã‚’æ­è¼‰ã—ã€é«˜é€Ÿãƒ‡ãƒ¼ã‚¿è»¢é€ãŒå¯èƒ½
- æœ‰ç·šLANï¼š300Mbps â†’ 1000Mbpsï¼ˆGigabit Ethernetï¼‰ã«é«˜é€ŸåŒ–
- Bluetooth 5.0 ã«å¯¾å¿œã—ã€å¾“æ¥æ¯” 2å€ã®è»¢é€é€Ÿåº¦
> Raspberry Pi 4 Model B/8GB element14
> [https://raspberry-pi.ksyic.com/?pdp.id=552](https://raspberry-pi.ksyic.com/?pdp.id=552)

## OS
### `/etc/os-release`
```bash
root@raspberrypi:~# cat /etc/os-release
PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
NAME="Debian GNU/Linux"
VERSION_ID="12"
VERSION="12 (bookworm)"
VERSION_CODENAME=bookworm
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```
### `uname`
```bash
root@raspberrypi:~# uname -a
Linux raspberrypi 6.6.51+rpt-rpi-v8 #1 SMP PREEMPT Debian 1:6.6.51-1+rpt3 (2024-10-08) aarch64 GNU/Linux
```
# 3. Sambaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
root@raspberrypi:~# apt-get update -y
root@raspberrypi:~# apt-get install -y samba
root@raspberrypi:~# samba --version
Version 4.17.12-Debian
```
# 4. å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ
## ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆ
```bash
root@raspberrypi:~# useradd -m storage
root@raspberrypi:~# cat /etc/passwd | grep 'storage'
storage:x:1002:1002::/home/storage:/bin/bash
```
ãƒ¦ãƒ¼ã‚¶ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š
ã€Œpassword updated successfullyã€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚
```bash
root@raspberrypi:~# passwd storage
New password:
Retype new password:
passwd: password updated successfully
```
:::message
`useradd`ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹éš›ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã¯ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã›ã‚“ã€‚`useradd -D` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`HOME_DIR=yes` ã®è¨­å®šãŒãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚ãã®ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã«ã¯ã€-m ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```bash
root@raspberrypi:~# useradd -D
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=no
LOG_INIT=yes
```
:::
:::message
> Generally, keep away from `useradd`, use adduser instead.
> Use `-m` instead of `-d`, so the directory will be created for you:
> [https://askubuntu.com/questions/374870/home-directory-not-being-created](https://askubuntu.com/questions/374870/home-directory-not-being-created)
:::
## ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
Sambaå°‚ç”¨ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ãŒSambaã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```bash
storage@raspberrypi:~ $ sudo groupadd shared
```
### å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ
```bash
storage@raspberrypi:~ $ mkdir shared
```
### ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®è¨­å®š
```bash
storage@raspberrypi:~ $ sudo chgrp shared ./shared/
storage@raspberrypi:~ $ sudo chmod 0777 ./shared/
```
# 5. Sambaã®è¨­å®š
> **smb.conf**
> The smb.conf file is a configuration file for the Samba suite. smb.conf contains runtime configuration information for the Samba programs. The complete description of the file format and possible parameters held within are here for reference purposes.
> [https://www.samba.gr.jp/project/translation/current/htmldocs/manpages/smb.conf.5.html](https://www.samba.gr.jp/project/translation/current/htmldocs/manpages/smb.conf.5.html)

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†
```bash
storage@raspberrypi:~ $ sudo vi /etc/samba/smb.conf
```
ä»¥ä¸‹ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã«è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚
```
[shared]
   comment = Private folder accessible only by authorized users.
   path = /home/storage/shared/
   browseable = yes
   read only = no
   create mask = 0777
   directory mask = 0777
   guest ok = no
   valid users = @shared
```

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³å | èª¬æ˜ |
| ---- | ---- |
| `comment` | å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®èª¬æ˜ã‚’è¨­å®šï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸€è¦§ã§è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰ |
| `path` | å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®å®Ÿéš›ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š |
| `browseable` | `yes`ãªã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸€è¦§ã«è¡¨ç¤ºã€`no`ãªã‚‰è¡¨ç¤ºã—ãªã„ï¼ˆç›´æ¥ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹å¯ï¼‰ |
| `read only` | `yes`ãªã‚‰èª­ã¿å–ã‚Šå°‚ç”¨ã€`no`ãªã‚‰æ›¸ãè¾¼ã¿ã‚‚å¯èƒ½ |
| `create mask` | æ–°è¦ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒ‡å®šï¼ˆ`0777`ã¯å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª­ã¿æ›¸ãå®Ÿè¡Œå¯èƒ½ï¼‰ |
| `directory mask` | æ–°è¦ä½œæˆã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒ‡å®šï¼ˆ`0777`ã¯å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰ |
| `guest ok` | `yes`ãªã‚‰ã‚²ã‚¹ãƒˆï¼ˆèªè¨¼ãªã—ï¼‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã€`no`ãªã‚‰èªè¨¼ãŒå¿…è¦ |
| `valid users` | ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æŒ‡å®šï¼ˆ`@shared`ã¯`shared`ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿è¨±å¯ï¼‰ |

:::message
ä¸Šè¨˜ã®è¨­å®šã§æ¥ç¶šã§ããªã„å ´åˆã¯ã€`testparm`ã‚’å®Ÿè¡Œã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å•é¡ŒãŒãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
> The program will issue a message saying whether the configuration file loaded OK or not. This message may be preceded by errors and warnings if the file did not load. If the file was loaded OK, the program then dumps all known service details to stdout.
> `ç¿»è¨³`: ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¤ºã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å•é¡ŒãŒã‚ã£ãŸå ´åˆã¯ã€ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰ã«ã‚¨ãƒ©ãƒ¼ã‚„è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå ´åˆã¯ã€ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°æƒ…å ±ãŒæ¨™æº–å‡ºåŠ›ï¼ˆstdoutï¼‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
> [https://www.samba.org/samba/docs/4.9/man-html/testparm.1.html](https://www.samba.org/samba/docs/4.9/man-html/testparm.1.html)
```
storage@raspberrypi:~ $ testparm
Load smb config files from /etc/samba/smb.conf
Loaded services file OK.
Weak crypto is allowed by GnuTLS (e.g. NTLM as a compatibility fallback)

Server role: ROLE_STANDALONE

Press enter to see a dump of your service definitions
```
:::

### Sambaã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•
```bash
storage@raspberrypi:~ $ sudo systemctl restart smbd.service
```
# 6. Sambaæ¥ç¶šç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
Sambaã§ã¯ã€Linuxã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã¯åˆ¥ã«ã€Sambaå°‚ç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ã§ãã¾ã™ã€‚ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Sambaã«æ¥ç¶šã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€Linuxãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã€Sambaãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ç™»éŒ²ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã®æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚
## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
```bash
storage@raspberrypi:~ $ sudo useradd samba-test -s /sbin/nologin
```
## Sambaãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ç™»éŒ²ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š
```bash
storage@raspberrypi:~ $ sudo smbpasswd -a samba-test
New SMB password:
Retype new SMB password:
Forcing Primary Group to 'Domain Users' for samba-test
Forcing Primary Group to 'Domain Users' for samba-test
```
Sambaã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ã¨ã€å…ˆã»ã©ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚
```bash
storage@raspberrypi:~ $ sudo pdbedit -L
```
## Sambaãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã€Œsharedã€ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
```bash
storage@raspberrypi:~ $ sudo usermod -aG shared samba-test
```
:::message alert
`usermod`ã§`-a`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã‚ãšã«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€æŒ‡å®šã—ãŸã‚°ãƒ«ãƒ¼ãƒ—ä»¥å¤–ã®ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚°ãƒ«ãƒ¼ãƒ—ã¯å‰Šé™¤ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚`-a`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€æŒ‡å®šã—ãŸã‚°ãƒ«ãƒ¼ãƒ—ãŒè¿½åŠ ã•ã‚Œã€æ—¢å­˜ã®ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚°ãƒ«ãƒ¼ãƒ—ãŒä¿æŒã•ã‚Œã¾ã™ã€‚
```
-G, --groups GROUP1[,GROUP2,...[,GROUPN]]]
    A list of supplementary groups which the user is also a member
    of. Each group is separated from the next by a comma, with no
    intervening whitespace. The groups must exist.

    If the user is currently a member of a group which is not
    listed, the user will be removed from the group. This
    behaviour can be changed via the -a option, which appends the
    user to the current supplementary group list.
```
:::
# 7. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç«¯æœ«ï¼ˆWindowsï¼‰ã‹ã‚‰å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã«æ¥ç¶š
1. ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã
å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹ã€ŒPCã€ã‚’ å³ã‚¯ãƒªãƒƒã‚¯ ã—ã¾ã™ã€‚

2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‰ãƒ©ã‚¤ãƒ–ã‚’å‰²ã‚Šå½“ã¦ã‚‹
è¡¨ç¤ºã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ ã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‰ãƒ©ã‚¤ãƒ–ã®å‰²ã‚Šå½“ã¦ã€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](/images/5d08f552928b22/Screenshot_2025-02-12_111541.png)
![](/images/5d08f552928b22/Screenshot_2025-02-12_175309.png)

3. å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹ã‚’å…¥åŠ›
ä»¥ä¸‹ã®å½¢å¼ã§ Raspberry Pi ã®å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹ ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
`\\<Raspberry Piã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>\<å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€å>\`
![](/images/5d08f552928b22/Screenshot_2025-02-12_105656.png)

4. èªè¨¼æƒ…å ±ã‚’å…¥åŠ›
ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§ã€è¨­å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
![](/images/5d08f552928b22/Screenshot_2025-02-12_105718.png)
# 8. ã¾ã¨ã‚
- Raspberry Piã«Sambaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€è‡ªå®…ã«ç°¡å˜ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã®ç®¡ç†ã‚’é©åˆ‡ã«è¡Œã„ã€ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’è¨­å®š ã™ã‚‹ã“ã¨ã§ã€å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ã‚’å®Ÿç¾ã€‚
- Windowsã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‰ãƒ©ã‚¤ãƒ–ã¨ã—ã¦æ¥ç¶šã—ã€å¿«é©ã«åˆ©ç”¨ã§ãã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã€‚